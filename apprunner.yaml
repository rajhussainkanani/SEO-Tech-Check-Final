version: 1.0
applications:
  - name: seo-tech-check-backend
    type: nodejs
    properties:
      runtime: nodejs18
      build:
        commands:
          - npm ci --only=production
      start:
        command: npm start
      port: 3001
      environment:
        variables:
          NODE_ENV: production
          PORT: 3001
          ENABLE_RATE_LIMITING: true
          RATE_LIMIT_WINDOW_MS: 900000
          RATE_LIMIT_MAX_REQUESTS: 100
          LOG_LEVEL: info
      healthcheck:
        command: node -e "require('http').get('http://localhost:3001/health', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) })"
        interval: 30
        timeout: 3
        retries: 3
        start_period: 5
      instance:
        cpu: 1
        memory: 2048

  - name: seo-tech-check-frontend
    type: nodejs
    properties:
      runtime: nodejs18
      build:
        commands:
          - npm i --legacy-peer-deps
          - npm i ajv@8.12.0 ajv-keywords@5.1.0
          - npm run build
      start:
        command: npx serve -s build -l 80
      port: 80
      environment:
        variables:
          NODE_ENV: production
          REACT_APP_API_URL: ${BACKEND_URL}/api  # Will be set during deployment
      healthcheck:
        command: wget --no-verbose --tries=1 --spider http://localhost:80/health || exit 1
        interval: 30
        timeout: 3
        retries: 3
        start_period: 5
      instance:
        cpu: 1
        memory: 2048

network:
  vpc:
    enable: true  # Enables VPC connectivity
